import{p as f,h as I}from"./services.99864b47.js";import{P as U}from"./ProxyInput.c7c194a6.js";import{D as j}from"./helper.8a7057fb.js";import{d as b,_ as C,c as p,V as $,o as n,w as l,a as k,b as t,e as x,f as A,g as L,h as S,i as N,j as d,k as B,l as D,m as F,n as c,p as m,q,r as i,s as u,t as K,u as M,v as E,x as y,y as z,z as w,A as _,B as G,F as O,C as H}from"./index.4ac873d2.js";import{C as J}from"./CheckBox.06b0a960.js";import{P as Q}from"./ProfileCard.e25382ec.js";const X=b({name:"ProfileLabelInput",props:["modelValue","profileId"],emits:["update:modelValue"],data(){return{loading:!1}},computed:{labelName:{get(){return this.modelValue},async set(e){await this.labelChanged(),this.$emit("update:modelValue",e)}}},methods:{async labelChanged(){const e=this.labelName;if(await j(1e3),this.labelName===e){if(this.loading=!0,!await this.validate()){this.loading=!1;return}this.loading=!1}},async validate(){const{valid:e}=await this.$refs["label-input"].validate();return e},labelRules(){return[async e=>this.labelName?(await f.profileServiceValidateLabel({body:{label:this.labelName,profileId:this.profileId}})).valid?!0:"label already exist. choose another label":"Label required"]}}});function Y(e,a,P,g,V,v){return n(),p($,{ref:"label-input",modelValue:e.labelName,"onUpdate:modelValue":a[0]||(a[0]=s=>e.labelName=s),label:"label",density:"comfortable",variant:"outlined",rules:e.labelRules(),onInput:e.labelChanged,loading:e.loading,disabled:e.loading},null,8,["modelValue","rules","onInput","loading","disabled"])}const T=C(X,[["render",Y]]),Z=b({name:"CreateProfile",components:{ProfileLabelInput:T,ProxyInput:U},props:{showProp:Boolean},emits:["updated","change"],watch:{showProp:{immediate:!0,handler(e,a){this.show=e}}},data(){return{show:this.showProp,item:{},mmskWalletId:"",saveLoading:!1}},methods:{resetForm(){this.item.proxy="",this.item.label="",this.item.meta="",this.item.mmskPk="",this.saveLoading=!1},mmskRules(){return[e=>this.item.mmskPk?this.item.mmskPk.length<64?"PK must is less than 64 characters":this.item.mmskPk.length>64?"PK must is more than 64 characters":!0:"PK is required",async e=>this.item.mmskPk&&this.item.mmskPk.length==64?(await I.helperServiceValidatePk({body:{pk:this.item.mmskPk}})).walletId?!0:"invalid PK":"API error, call an ambulance!"]},async proxyChanged(e){this.item.proxy=e},async mmskPkChanged(e){if(await this.validatePk(),this.item.mmskPk.length==64){const a=await I.helperServiceValidatePk({body:{pk:this.item.mmskPk}});a.walletId&&(this.mmskWalletId="wallet id: "+a.walletId)}else this.mmskWalletId=""},async validate(){const{valid:e}=await this.$refs["label-input"].validate();return e},async validatePk(){const{valid:e}=await this.$refs["pk-input"].validate();return e},async validateForm(){const{valid:e}=await this.$refs.form.validate();return e},async CreateProfile(){if(this.saveLoading=!0,!await this.validateForm()){this.saveLoading=!1;return}try{await f.profileServiceCreateProfile({body:this.item}),this.$emit("change",!1),this.$emit("updated"),this.resetForm()}catch{this.saveLoading=!1}},Close(){this.$emit("change",!1)}}}),ee=i("span",{class:"text-h5"},"Create profile",-1);function te(e,a,P,g,V,v){const s=u("ProfileLabelInput"),h=u("ProxyInput");return n(),p(k,{justify:"center"},{default:l(()=>[t(q,{modelValue:e.show,"onUpdate:modelValue":a[4]||(a[4]=o=>e.show=o),persistent:"",width:"1024"},{default:l(()=>[t(x,null,{default:l(()=>[t(A,null,{default:l(()=>[ee]),_:1}),t(L,null,{default:l(()=>[t(S,null,{default:l(()=>[t(N,{"validate-on":"submit",ref:"form"},{default:l(()=>[t(k,null,{default:l(()=>[t(d,{cols:"12",sm:"6",md:"4"},{default:l(()=>[t(s,{modelValue:e.item.label,"onUpdate:modelValue":a[0]||(a[0]=o=>e.item.label=o)},null,8,["modelValue"])]),_:1}),t(d,{cols:"12",sm:"12",md:"8"},{default:l(()=>[t($,{ref:"pk-input",rules:e.mmskRules(),onInput:e.mmskPkChanged,modelValue:e.item.mmskPk,"onUpdate:modelValue":a[1]||(a[1]=o=>e.item.mmskPk=o),messages:e.mmskWalletId,density:"comfortable",variant:"outlined",label:"metamask wallet private key*",hint:"metamask wallet private key"},null,8,["rules","onInput","modelValue","messages"])]),_:1}),t(d,{cols:"12"},{default:l(()=>[t(h,{required:!1,modelValue:e.item.proxy,"onUpdate:modelValue":a[2]||(a[2]=o=>e.item.proxy=o)},null,8,["modelValue"])]),_:1}),t(d,{cols:"12"},{default:l(()=>[t(B,{label:"Meta",type:"Meta",modelValue:e.item.meta,"onUpdate:modelValue":a[3]||(a[3]=o=>e.item.meta=o),density:"comfortable",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),t(D,null,{default:l(()=>[t(F),t(c,{color:"blue-darken-1",variant:"text",onClick:e.Close},{default:l(()=>[m(" Close ")]),_:1},8,["onClick"]),t(c,{type:"submit",color:"blue-darken-1",variant:"text",loading:e.saveLoading,onClick:e.CreateProfile},{default:l(()=>[m(" Save ")]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const le=C(Z,[["render",te]]),ae=b({name:"BtnCheckProxy",props:{proxy:{type:String,required:!0}},data(){return{loading:!1,menu:!1,stat:""}},computed:{},methods:{async click(){try{this.loading=!0;const e=await I.helperServiceValidateProxy({body:{proxy:this.proxy}});this.stat=`${e.ip} ${e.countryName} [${e.countryCode}]`}finally{this.loading=!1}}}}),oe={key:0},ie={key:1};function se(e,a,P,g,V,v){return n(),p(K,{modelValue:e.menu,"onUpdate:modelValue":a[0]||(a[0]=s=>e.menu=s),"close-on-content-click":!1},{activator:l(({props:s})=>[t(E,M(s,{onClick:e.click,icon:"mdi-check-network-outline"}),null,16,["onClick"])]),default:l(({props:s})=>[t(x,null,{default:l(()=>[t(L,null,{default:l(()=>[e.loading?(n(),y("span",oe,[m("stat: "),t(z,{indeterminate:"",color:"primary"})])):(n(),y("span",ie," stat: "+w(e.stat),1))]),_:1})]),_:1})]),_:1},8,["modelValue"])}const ne=C(ae,[["render",se]]),re=b({name:"EditProfile",components:{ProfileLabelInput:T,ProxyInput:U},emits:["updated"],props:{profileId:{required:!0,type:String}},data(){return{show:!1,item:{id:"",proxy:"",meta:"",mmskId:"",label:"",okexAccount:{}},okexAccount:{},mmskWalletId:"",saveLoading:!1,profileLoading:!1,updating:!1}},methods:{async proxyChanged(e){this.item.proxy=e},async validateForm(){const{valid:e}=await this.$refs.form.validate();return e},async Update(){if(this.updating=!0,!await this.validateForm()){this.updating=!1;return}try{await f.profileServiceUpdateProfile({body:{label:this.item.label,profileId:this.profileId,meta:this.item.meta,proxy:this.item.proxy,okexAccount:this.okexAccount}}),this.$emit("updated"),this.show=!1}finally{this.updating=!1}},async loadProfile(){try{this.profileLoading=!0;const e=await f.profileServiceGetProfile({body:{profileId:this.profileId}});this.item=e.profile,this.item.okexAccount?this.okexAccount=this.item.okexAccount:this.item.okexAccount={subAccName:"",depositAddr:""}}catch{this.profileLoading=!1}},Close(){this.show=!1}}}),de=i("span",{class:"text-h5"},"Edit profile",-1),ue=i("div",null,[i("b",null,"Okex account"),m(" (optional) might be used for withdraw crypto from metamsk to okex")],-1),me=i("br",null,null,-1);function fe(e,a,P,g,V,v){const s=u("ProfileLabelInput"),h=u("ProxyInput");return n(),p(k,{justify:"center"},{default:l(()=>[t(q,{modelValue:e.show,"onUpdate:modelValue":a[5]||(a[5]=o=>e.show=o),persistent:"",width:"1024"},{activator:l(({props:o})=>[t(E,M({icon:"mdi-account-edit-outline"},o,{onClick:e.loadProfile}),null,16,["onClick"])]),default:l(()=>[t(x,null,{default:l(()=>[t(A,null,{default:l(()=>[de]),_:1}),t(L,null,{default:l(()=>[t(S,null,{default:l(()=>[t(N,{"validate-on":"submit",ref:"form"},{default:l(()=>[t(k,null,{default:l(()=>[t(d,{cols:"12",sm:"6",md:"4"},{default:l(()=>[t(s,{modelValue:e.item.label,"onUpdate:modelValue":a[0]||(a[0]=o=>e.item.label=o),"profile-id":e.profileId},null,8,["modelValue","profile-id"])]),_:1}),t(d,{cols:"12"},{default:l(()=>[t(h,{required:!1,modelValue:e.item.proxy,"onUpdate:modelValue":a[1]||(a[1]=o=>e.item.proxy=o)},null,8,["modelValue"])]),_:1}),t(d,{cols:"12"},{default:l(()=>[t(B,{label:"Meta",type:"Meta",modelValue:e.item.meta,"onUpdate:modelValue":a[2]||(a[2]=o=>e.item.meta=o),density:"comfortable",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),ue,me,t(k,null,{default:l(()=>[t(d,null,{default:l(()=>[t($,{label:"okex account/sub-account name",modelValue:e.okexAccount.subAccName,"onUpdate:modelValue":a[3]||(a[3]=o=>e.okexAccount.subAccName=o),density:"comfortable",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(d,null,{default:l(()=>[t($,{label:"okex deposit addr",modelValue:e.okexAccount.depositAddr,"onUpdate:modelValue":a[4]||(a[4]=o=>e.okexAccount.depositAddr=o),density:"comfortable",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),t(D,null,{default:l(()=>[t(F),t(c,{color:"blue-darken-1",variant:"text",onClick:e.Close},{default:l(()=>[m(" Close ")]),_:1},8,["onClick"]),t(c,{type:"submit",color:"blue-darken-1",variant:"text",loading:e.updating,onClick:e.Update},{default:l(()=>[m(" Save ")]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const pe=C(re,[["render",fe]]),ce=b({name:"Profiles",components:{EditProfile:pe,BtnCheckProxy:ne,CheckBox:J,CreateProfile:le,ProfileCard:Q},props:{},data(){return{list:[],showCreateProfileDialog:!1,selected:new Set}},computed:{getList(){return this.list},selectedSome(){return this.selected.size>0}},methods:{CheckboxChanged(e,a){a?this.selected.add(e):this.selected.delete(e)},async UpdateList(){const e=await f.profileServiceListProfile();this.list=e.profiles,this.selected=new Set},CreateProfile(){this.showCreateProfileDialog=!0},CreateProfileChange(e){this.showCreateProfileDialog=e},async DeleteProfiles(){for(let e of this.selected.keys())await f.profileServiceDeleteProfile({body:{id:e}});await this.UpdateList()}},created(){this.UpdateList()}}),he={class:"d-flex justify-end"},ke=i("thead",null,[i("tr",null,[i("th"),i("th",{class:"text-left"},"Profile"),i("th",{class:"text-left"},"Metamask wallet key"),i("th",{class:"text-left"},"Proxy"),i("th",{class:"text-left"},"Meta"),i("th",{class:"text-left"},"Actions")])],-1);function ye(e,a,P,g,V,v){const s=u("CheckBox"),h=u("ProfileCard"),o=u("BtnCheckProxy"),R=u("EditProfile"),W=u("CreateProfile");return n(),y("div",null,[i("div",he,[e.selectedSome?(n(),p(c,{key:0,color:"black",onClick:e.DeleteProfiles,class:"ma-3"},{default:l(()=>[m("Delete profiles")]),_:1},8,["onClick"])):_("",!0),t(c,{onClick:e.CreateProfile,class:"ma-3"},{default:l(()=>[m("Create profile")]),_:1},8,["onClick"])]),t(G,null,{default:l(()=>[ke,i("tbody",null,[(n(!0),y(O,null,H(e.getList,r=>(n(),y("tr",{key:r.id},[i("td",null,[t(s,{style:{height:"40px"},density:"compact",id:r.id,focused:"",onCheckboxChanged:e.CheckboxChanged},null,8,["id","onCheckboxChanged"])]),i("td",null,[t(h,{"profile-id":r.id},null,8,["profile-id"])]),i("td",null,w(r.mmskId),1),i("td",null,[r.proxy?(n(),p(o,{key:0,proxy:r.proxy},null,8,["proxy"])):_("",!0),m(" "+w(r.proxy||"disabled"),1)]),i("td",null,w(r.meta),1),i("td",null,[t(R,{"profile-id":r.id,onUpdated:e.UpdateList},null,8,["profile-id","onUpdated"])])]))),128))])]),_:1}),t(W,{showProp:e.showCreateProfileDialog,onChange:e.CreateProfileChange,onUpdated:e.UpdateList},null,8,["showProp","onChange","onUpdated"])])}const we=C(ce,[["render",ye]]);export{we as default};
