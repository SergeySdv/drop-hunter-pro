import{e as L,P as g,d as G,c as S,h as N}from"./services.99864b47.js";import B from"./ViewFlow.fc21281e.js";import{S as F,B as U}from"./BtnProcessStopResume.7c73d377.js";import{G as H}from"./helper.8a7057fb.js";import{d as A,_ as M,c as w,w as t,t as _,o as r,b as s,p as o,u as j,n as I,g as E,r as P,z as u,x as l,A as h,L as b,C as T,F as k,l as q,e as z,s as y,a as v,j as f,M as Y,N as O,O as V}from"./index.4ac873d2.js";import{P as J}from"./ProfileCard.e25382ec.js";import"./tasks.e8742239.js";const K=A({name:"ProcessTaskMenu",components:{StatusCard:F,ViewFlow:B},props:{task:{type:Object,required:!0},processProfileId:{type:String,required:!0},processId:{type:String,required:!0},profileId:{type:String,required:!0}},data(){return{menu:!1,disabled:!0,retryLoading:!1,records:[],stargateTaskFee:""}},computed:{TaskType(){return L},ProcessStatus(){return g},GetStargateTaskFee(){return this.stargateTaskFee}},methods:{dayjs:G,GetStatusColor:H,errorHappen(e){return e.status==g.StatusError},async loadHistory(){if(!!this.menu)try{const e=await S.processServiceGetProcessTaskHistory({body:{taskId:this.task.id}});this.records=e.records}finally{}},async getStargateBridgeFee(e,a,i){try{const p=await N.helperServiceEstimateStargateBridgeFee({body:{from:e,to:a,profileId:i}});return JSON.stringify(p)}finally{}},async retry(e,a){try{this.retryLoading=!0,await S.processServiceRetryProcess({body:{processId:this.processId,profileId:a,taskId:e.id}})}finally{await new Promise(i=>{setTimeout(()=>{i(1)},1e3)}),this.retryLoading=!1}}},async mounted(){var e,a;if(await this.loadHistory(),this.task.task.taskType===L.StargateBridge){const i=(e=this.task.task.stargateBridgeTask)==null?void 0:e.fromNetwork,p=(a=this.task.task.stargateBridgeTask)==null?void 0:a.toNetwork;i&&p&&(this.stargateTaskFee=await this.getStargateBridgeFee(i,p,this.profileId))}}}),Q={key:0},W={key:1},X={key:2},Z=["href"];function x(e,a,i,p,R,D){const m=y("StatusCard");return r(),w(_,{modelValue:e.menu,"onUpdate:modelValue":a[1]||(a[1]=c=>e.menu=c),"close-on-content-click":!1,location:"end"},{activator:t(({props:c})=>[s(I,j(c,{color:e.GetStatusColor(e.task.status),onClick:e.loadHistory}),{default:t(()=>[o("Info ")]),_:2},1040,["color","onClick"])]),default:t(({props:c})=>[s(z,null,{default:t(()=>[s(E,null,{default:t(()=>[P("b",null,u(e.errorHappen(e.task)?"error:"+e.task.error:""),1),e.errorHappen(e.task)?(r(),l("br",Q)):h("",!0),s(b),o(" "+u(e.task.task.description)+" ",1),e.task.task.taskType===e.TaskType.StargateBridge?(r(),l("div",W,[o(u(e.GetStargateTaskFee)+" ",1),s(b)])):h("",!0),(r(!0),l(k,null,T(e.records,n=>(r(),l("div",{key:n.id},[s(b),o(" "+u(`${e.dayjs(n.startedAt).format("YYYY-MM-DD HH:mm:ss")}`)+" ",1),s(m,{status:n.startStatus},null,8,["status"]),o(" -> "),s(m,{status:n.finishStatus?n.finishStatus:e.ProcessStatus.StatusReady},null,8,["status"]),o(" "+u(n.msg),1)]))),128)),e.task.transactions.length>0?(r(),l("div",X,[o(" Transactions: "),(r(!0),l(k,null,T(e.task.transactions,(n,C)=>(r(),l("div",null,[P("a",{href:n,target:"_blank"},"tx: "+u(C),9,Z)]))),256))])):h("",!0)]),_:1}),s(q,null,{default:t(()=>[e.errorHappen(e.task)?(r(),w(I,{key:0,onClick:a[0]||(a[0]=n=>e.retry(e.task,e.processProfileId)),loading:e.retryLoading},{default:t(()=>[o("Retry ")]),_:1},8,["loading"])):h("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])}const ee=M(K,[["render",x]]),se=A({name:"ViewProcess",components:{BtnProcessStopResume:U,ProfileCard:J,StatusCard:F,ViewFlow:B,ProcessTaskMenu:ee},props:{},watch:{loadingMap:{handler:()=>{},deep:!0}},data(){return{checkboxLabel:"detailed",density:"compact",showLess:!0,menu:!1,processId:this.$route.params.id.toString(),process:{},profiles:[],updatedAt:new Date(1)}},computed:{getCheckboxLabel(){return this.showLess?"less details":"more details"},ProcessStatus(){return g},getProfileList(){return this.profiles}},methods:{showLessChanged(){this.showLess?this.density="compact":this.density="comfortable"},GetStatusColor:H,errorHappen(e){return e.status==g.StatusError},processUpdated(){}},async created(){const e=async()=>{if(this.$route.params.id){const a=await S.processServiceGetProcessUpdatedAt({body:{processId:this.processId}});if(new Date(a.updatedAt).getTime()>this.updatedAt.getTime()){this.updatedAt=new Date(a.updatedAt);const i=await S.processServiceGetProcess({body:{id:this.processId}});this.process=i.process,this.profiles=this.process.profiles}}};await e(),setInterval(async()=>{await e()},1e3)}}),te=P("br",null,null,-1),ae={style:{"font-size":"13px"}};function re(e,a,i,p,R,D){const m=y("StatusCard"),c=y("BtnProcessStopResume"),n=y("ProfileCard"),C=y("ProcessTaskMenu");return r(),l(k,null,[s(v,{class:"text-h5 mt-4 ml-5 d-flex justify-sm-space-between"},{default:t(()=>[s(f,{cols:"12",sm:"8",md:"8",lg:"8"},{default:t(()=>[o(u(`${e.process.flowLabel} `)+" ",1),s(m,{class:"ml-3",status:e.process.status},null,8,["status"]),te,P("span",ae,u(`(${e.process.id})`),1)]),_:1}),s(f,{cols:"12",sm:"4",md:"4",lg:"4"},{default:t(()=>[s(Y,{density:"comfortable",focused:"",modelValue:e.showLess,"onUpdate:modelValue":a[0]||(a[0]=d=>e.showLess=d),label:e.getCheckboxLabel,onInput:e.showLessChanged},null,8,["modelValue","label","onInput"]),s(c,{size:"comfortable",item:e.process,onUpdated:e.processUpdated},null,8,["item","onUpdated"]),s(I,{density:"comfortable",class:"ml-3",onClick:a[1]||(a[1]=d=>e.$router.push({name:"ViewFlow",params:{id:e.process.flowId}}))},{default:t(()=>[o(" Show Flow ")]),_:1})]),_:1})]),_:1}),(r(!0),l(k,null,T(e.process.profiles,d=>(r(),w(v,{class:"mt-4 ml-5 mr-5 align-center"},{default:t(()=>[s(f,{cols:"12",sm:"2",md:"2",lg:"1"},{default:t(()=>[s(n,{"profile-id":d.profileId},null,8,["profile-id"])]),_:2},1024),s(f,{cols:"12",sm:"1",md:"1",lg:"1"},{default:t(()=>[s(m,{status:d.status},null,8,["status"])]),_:2},1024),s(f,{cols:"12",sm:"9",md:"9",lg:"9"},{default:t(()=>[s(O,{direction:"horizontal",density:e.density,"line-inset":"12"},{default:t(()=>[s(V,{"dot-color":d.status===e.ProcessStatus.StatusReady?"grey":"green"},{opposite:t(()=>[o(" Start ")]),_:2},1032,["dot-color"]),(r(!0),l(k,null,T(d.tasks,$=>(r(),w(V,null,{icon:t(()=>[s(C,{task:$,"profile-id":d.profileId,"process-id":e.processId,"process-profile-id":d.id},null,8,["task","profile-id","process-id","process-profile-id"])]),opposite:t(()=>[o(u($.task.taskType),1)]),_:2},1024))),256)),s(V,{"dot-color":d.status===e.ProcessStatus.StatusDone?"green":"grey"},{opposite:t(()=>[o(" End ")]),_:2},1032,["dot-color"])]),_:2},1032,["density"])]),_:2},1024)]),_:2},1024))),256))],64)}const ce=M(se,[["render",re]]);export{ce as default};
