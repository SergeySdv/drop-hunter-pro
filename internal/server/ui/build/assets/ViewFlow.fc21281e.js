import{T as u,p as c,c as w,f as b}from"./services.99864b47.js";import{P}from"./ProfileCard.e25382ec.js";import{s as C}from"./tasks.e8742239.js";import{d as V,_ as y,x as r,b as s,w as l,f as S,h as v,F as n,o as i,r as k,z as I,a as p,j as d,K as T,C as m,n as F,p as L,m as g,i as $,V as B,c as M,I as U,s as _}from"./index.4ac873d2.js";const D=V({name:"ViewFlow",components:{ProfileCard:P},props:{propId:{type:String,required:!1}},data(){return{profilesLoading:!1,flowId:"",selectedProfiles:[],suggestedProfile:"",suggestedProfiles:[],flow:{},disabled:!0,stepComponents:[],stepMap:new Map,stepTypes:[u.StargateBridge,u.Delay],saveLoading:!1}},computed:{getTasks(){return this.stepComponents},getProfileList(){return this.selectedProfiles}},methods:{async ProfileSuggestChanged(e){this.suggestedProfile=e;try{const t=e;await new Promise((a,f)=>{setTimeout(()=>{this.suggestedProfile===t?a({}):f({})},1e3)})}catch{return}try{this.profilesLoading=!0;const t=await c.profileServiceSearchProfile({body:{pattern:e}});this.suggestedProfiles=t.profiles}finally{this.profilesLoading=!1}},stepChanged(e){console.log(e),this.stepMap.set(e.weight,e)},async startProcess(){const e=await w.processServiceCreateProcess({body:{flowId:this.flowId,profileIds:this.selectedProfiles.map(t=>t.id)}});this.$router.push({name:"ViewProcess",params:{id:e.process.id}})}},async mounted(){if(console.log(this.propId),this.propId?this.flowId=this.propId:this.$route.params.id&&(this.flowId=this.$route.params.id.toString()),this.$route.params.id){const t=await b.flowServiceGetFlow({body:{id:this.flowId}});this.flow=t.flow,this.flow.tasks.forEach(a=>{this.stepMap.set(a.weight,a),this.stepComponents.push({c:C.get(a.taskType),i:a.weight,task:a})})}const e=await c.profileServiceSearchProfile({body:{pattern:""}});this.suggestedProfiles=e.profiles}}),N={class:"text-h5"};function j(e,t,a,f,E,q){const h=_("ProfileCard");return i(),r(n,null,[s(S,null,{default:l(()=>[k("span",N,"Flow: "+I(e.flow.label),1)]),_:1}),s(v,{fluid:""},{default:l(()=>[s(p,{class:"mb-8"},{default:l(()=>[s(d,null,{default:l(()=>[s(T,{clearable:"","return-object":"",loading:e.profilesLoading,modelValue:e.selectedProfiles,"onUpdate:modelValue":t[0]||(t[0]=o=>e.selectedProfiles=o),items:e.suggestedProfiles,"item-children":"","item-title":"label","item-value":"id","onUpdate:search":e.ProfileSuggestChanged,multiple:"",ref:"label-input",label:"select profiles",density:"comfortable",variant:"outlined"},null,8,["loading","modelValue","items","onUpdate:search"]),(i(!0),r(n,null,m(e.getProfileList,o=>(i(),r("div",null,[s(h,{"profile-id":o.id},null,8,["profile-id"])]))),256))]),_:1}),s(d,null,{default:l(()=>[s(F,{disabled:e.selectedProfiles.length===0,onClick:e.startProcess},{default:l(()=>[L("Start flow")]),_:1},8,["disabled","onClick"])]),_:1})]),_:1}),s(g),s($,{"validate-on":"submit",ref:"flow-form"},{default:l(()=>[s(p,null,{default:l(()=>[s(d,{cols:"12",sm:"6",md:"4"},{default:l(()=>[s(B,{ref:"label-input",modelValue:e.flow.label,"onUpdate:modelValue":t[1]||(t[1]=o=>e.flow.label=o),label:"label",density:"comfortable",variant:"outlined",disabled:e.disabled},null,8,["modelValue","disabled"])]),_:1})]),_:1}),s(g),s(p,null,{default:l(()=>[s(d),s(d)]),_:1}),(i(!0),r(n,null,m(e.getTasks,o=>(i(),r("div",null,[(i(),M(U(o.c),{class:"mb-5",onStepChanged:e.stepChanged,task:o.task,disabled:e.disabled,style:{"box-shadow":"rgba(0, 0, 0, 0.16) 0px 3px 6px, rgba(0, 0, 0, 0.23) 0px 3px 6px"},weight:o.i},null,40,["onStepChanged","task","disabled","weight"]))]))),256))]),_:1},512)]),_:1})],64)}const R=y(D,[["render",j]]);export{R as default};
